<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–æ–π 8-–¥–Ω–µ–≤–Ω—ã–π —Ü–∏–∫–ª ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∞</title>
  <style>
    :root {
      --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af;
      --accent:#22c55e; --accent2:#3b82f6; --danger:#ef4444; --line:#1f2937;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f3f4f6; --card:#fff; --text:#111827; --muted:#6b7280;
        --accent:#16a34a; --accent2:#2563eb; --danger:#dc2626; --line:#e5e7eb;
      }
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif}
    .wrap{max-width:780px;margin:0 auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;
      padding:16px;margin:12px 0;box-shadow:0 6px 24px rgba(0,0,0,.1)}
    h1{font-size:clamp(22px,4.5vw,30px);margin:4px 0 12px}
    h2{font-size:clamp(18px,4vw,22px);margin:0 0 8px}
    .muted{color:var(--muted)} .small{font-size:13px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{border:1px solid var(--line);background:var(--card);color:var(--text);
      padding:10px 14px;border-radius:10px;font-weight:600}
    .btn-primary{background:var(--accent);border-color:transparent;color:#fff}
    .btn-secondary{background:#e5e7eb;color:#111827;border-color:#d1d5db}
    .btn-danger{background:var(--danger);border-color:transparent;color:#fff}
    .pill{display:inline-block;background:#0ea5e9;color:#fff;border-radius:999px;
      padding:6px 10px;font-weight:700}
    .grid{display:grid;grid-template-columns:48px 1fr 1fr 1fr;gap:8px;align-items:center}
    .th{font-size:14px;color:var(--muted)} .hr{height:1px;background:var(--line);margin:12px 0}
    label.chk{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--line);border-radius:12px}
    input[type="checkbox"]{width:20px;height:20px}
    .today{border:2px solid var(--accent)}
    select,input[type="date"]{padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--card);color:var(--text)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üóì –ú–æ–π 8-–¥–Ω–µ–≤–Ω—ã–π —Ü–∏–∫–ª</h1>
    <p class="muted small">–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É —Å—Ç–∞—Ä—Ç–∞ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å —Ü–∏–∫–ª–∞.</p>

    <!-- –°—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞ -->
    <div class="card" id="startCard">
      <h2>üìç –°—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞</h2>
      <div class="row">
        <input type="date" id="startInput" />
        <select id="startIndex">
          <option value="1">–î–µ–Ω—å 1 ‚Äî –î–Ω–µ–≤–Ω–∞—è (1 –∏–∑ 2)</option>
          <option value="2">–î–µ–Ω—å 2 ‚Äî –î–Ω–µ–≤–Ω–∞—è (2 –∏–∑ 2)</option>
          <option value="3">–î–µ–Ω—å 3 ‚Äî –í—ã—Ö–æ–¥–Ω–æ–π (1 –∏–∑ 2)</option>
          <option value="4">–î–µ–Ω—å 4 ‚Äî –í—ã—Ö–æ–¥–Ω–æ–π (2 –∏–∑ 2)</option>
          <option value="5">–î–µ–Ω—å 5 ‚Äî –ù–æ—á–Ω–∞—è (1 –∏–∑ 2)</option>
          <option value="6">–î–µ–Ω—å 6 ‚Äî –ù–æ—á–Ω–∞—è (2 –∏–∑ 2)</option>
          <option value="7">–î–µ–Ω—å 7 ‚Äî –û—Ç—Å—ã–ø–Ω–æ–π</option>
          <option value="8">–î–µ–Ω—å 8 ‚Äî –í—ã—Ö–æ–¥–Ω–æ–π (–ø–æ—Å–ª–µ –æ—Ç—Å—ã–ø–Ω–æ–≥–æ)</option>
        </select>
        <button class="btn btn-primary" id="saveStartBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="btn btn-danger" id="resetStartBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
      <p class="muted small" id="startInfo"></p>
    </div>

    <!-- –°–µ–≥–æ–¥–Ω—è -->
    <div class="card today" id="todayCard" hidden>
      <h2 id="todayTitle">–°–µ–≥–æ–¥–Ω—è: –¥–µ–Ω—å ‚Ä¶</h2>
      <p class="muted" id="todayHint"></p>
      <div id="todayTasks"></div>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="resetToday">–°–±—Ä–æ—Å–∏—Ç—å –≥–∞–ª–æ—á–∫–∏</button>
      </div>
    </div>

    <!-- –í—Å—è —Ç–∞–±–ª–∏—Ü–∞ -->
    <div class="card">
      <h2>–¶–∏–∫–ª (–æ–±–∑–æ—Ä)</h2>
      <div class="grid th">
        <div>–î–µ–Ω—å</div><div>–°–º–µ–Ω–∞/—Ä–µ–∂–∏–º</div><div>–£—á—ë–±–∞</div><div>–ó–∞–ª</div>
      </div>
      <div class="hr"></div>
      <div id="gridBody"></div>
    </div>

    <div class="card">
      <div class="row">
        <a class="btn" href="./index.html">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <button class="btn btn-secondary" id="shareBtn">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π</button>
      </div>
      <p class="muted small">–û—Ç–ø—Ä–∞–≤—å —ç—Ç—É —Å—Å—ã–ª–∫—É —Å–µ–±–µ –≤ Telegram –∏ –æ—Ç–∫—Ä—ã–≤–∞–π –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ.</p>
    </div>
  </div>

  <script>
    // –ú–æ–¥–µ–ª—å 8-–¥–Ω–µ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
    const DAYS = [
      { n:1, type:'day',   name:'–î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞ (1 –∏–∑ 2)',   study:'–õ—ë–≥–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ (15‚Äì20 –º–∏–Ω)', gym:'–ù–µ—Ç',  hint:'–õ–µ—á—å –ø–æ—Ä–∞–Ω—å—à–µ' },
      { n:2, type:'day',   name:'–î–Ω–µ–≤–Ω–∞—è —Å–º–µ–Ω–∞ (2 –∏–∑ 2)',   study:'–õ—ë–≥–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ (15‚Äì20 –º–∏–Ω)', gym:'–ù–µ—Ç',  hint:'–≠–∫–æ–Ω–æ–º–∏–º —Å–∏–ª—ã' },
      { n:3, type:'off',   name:'–í—ã—Ö–æ–¥–Ω–æ–π (1 –∏–∑ 2)',        study:'–ù–æ–≤—ã–µ —Ç–µ–º—ã + –ø—Ä–æ–µ–∫—Ç',            gym:'–ó–∞–ª',  hint:'–°–∏–ª–∞: –≥—Ä—É–¥—å/—Å–ø–∏–Ω–∞/—Ä—É–∫–∏' },
      { n:4, type:'off',   name:'–í—ã—Ö–æ–¥–Ω–æ–π (2 –∏–∑ 2)',        study:'–ù–æ–≤—ã–µ —Ç–µ–º—ã + –ø—Ä–æ–µ–∫—Ç',            gym:'–ó–∞–ª',  hint:'–ù–æ–≥–∏/–ø—Ä–µ—Å—Å + –∫–∞—Ä–¥–∏–æ' },
      { n:5, type:'night', name:'–ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞ (1 –∏–∑ 2)',    study:'–ö–æ—Ä–æ—Ç–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)', gym:'–ù–µ—Ç', hint:'–°–æ–Ω –¥–Ω—ë–º' },
      { n:6, type:'night', name:'–ù–æ—á–Ω–∞—è —Å–º–µ–Ω–∞ (2 –∏–∑ 2)',    study:'–ö–æ—Ä–æ—Ç–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)', gym:'–ù–µ—Ç', hint:'–°–æ–Ω –¥–Ω—ë–º' },
      { n:7, type:'rest',  name:'–û—Ç—Å—ã–ø–Ω–æ–π',                 study:'–¢–æ–ª—å–∫–æ –ª—ë–≥–∫–∞—è —Ç–µ–æ—Ä–∏—è –¥–æ 30 –º–∏–Ω', gym:'–ù–µ—Ç',  hint:'–ú–∞–∫—Å–∏–º—É–º —Å–Ω–∞' },
      { n:8, type:'off',   name:'–í—ã—Ö–æ–¥–Ω–æ–π (–ø–æ—Å–ª–µ –æ—Ç—Å—ã–ø–Ω–æ–≥–æ)', study:'–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —É—á—ë–±–∞ + –ø—Ä–æ–µ–∫—Ç',   gym:'–ó–∞–ª',  hint:'–°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞' },
    ];

    // –ö–ª—é—á–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    const KEY_START_DATE  = 'andrey_cycle_start_date';
    const KEY_START_INDEX = 'andrey_cycle_start_index';

    // –£—Ç–∏–ª–∏—Ç—ã
    const todayISO = () => {
      const d = new Date();
      const y = d.getFullYear(), m = String(d.getMonth()+1).padStart(2,'0'), day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    };
    const checksKey = () => `andrey_checks_${todayISO()}`;
    const toMidnight = d => new Date(d.getFullYear(), d.getMonth(), d.getDate());

    // –†–µ–Ω–¥–µ—Ä —Å–µ—Ç–∫–∏
    function renderGrid() {
      const wrap = document.getElementById('gridBody');
      wrap.innerHTML = '';
      DAYS.forEach(d => {
        const row = document.createElement('div');
        row.className = 'grid';
        row.innerHTML = `
          <div><span class="pill">${d.n}</span></div>
          <div>${d.name}</div>
          <div>${d.study}</div>
          <div>${d.gym}</div>
        `;
        wrap.appendChild(row);
      });
    }

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è —Ü–∏–∫–ª–∞ —Å —É—á—ë—Ç–æ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
    function getCycleDay(startDate, startIndex, now) {
      const a = toMidnight(startDate);
      const b = toMidnight(now);
      const diff = Math.floor((b - a) / 86400000); // —á–∏—Å–ª–æ —Å—É—Ç–æ–∫
      const shift = ((diff % 8) + 8) % 8;
      // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å 1..8 -> –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ 0..7
      const base = (Number(startIndex) - 1 + shift) % 8;
      return base + 1; // 1..8
    }

    // –†–µ–Ω–¥–µ—Ä "–°–µ–≥–æ–¥–Ω—è"
    function renderToday(dayIdx) {
      const model = DAYS[dayIdx - 1];
      document.getElementById('todayTitle').textContent = `–°–µ–≥–æ–¥–Ω—è: –¥–µ–Ω—å ${dayIdx} ‚Äî ${model.name}`;
      document.getElementById('todayHint').textContent  = model.hint;

      const holder = document.getElementById('todayTasks');
      holder.innerHTML = '';
      const saved = JSON.parse(localStorage.getItem(checksKey()) || '{}');

      const tasks = [];
      if (model.gym === '–ó–∞–ª') tasks.push({ id:'gym', label:'–ó–∞–ª / —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞' });
      if (model.type === 'day')   tasks.push({ id:'sleep', label:'–õ–µ—á—å –ø–æ—Ä–∞–Ω—å—à–µ' });
      if (model.type === 'night') tasks.push({ id:'sleep', label:'–°–æ–Ω –¥–Ω—ë–º' });
      if (model.type === 'rest')  tasks.push({ id:'sleep', label:'–û—Ç—Å—ã–ø–Ω–æ–π ‚Äî –º–∞–∫—Å–∏–º—É–º —Å–Ω–∞' });
      // –£—á—ë–±–∞
      if (/–ø–æ –∂–µ–ª–∞–Ω–∏—é/i.test(model.study)) {
        tasks.push({ id:'study', label:'–£—á—ë–±–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏—é): –∫–æ—Ä–æ—Ç–∫–æ' });
      } else {
        tasks.push({ id:'study', label:`–£—á—ë–±–∞: ${model.study}` });
      }

      tasks.forEach(t => {
        const lab = document.createElement('label');
        lab.className = 'chk';
        lab.innerHTML = `<input type="checkbox" id="t_${t.id}"><span>${t.label}</span>`;
        holder.appendChild(lab);
        const cb = lab.querySelector('input');
        cb.checked = !!saved[t.id];
        cb.addEventListener('change', () => {
          const data = JSON.parse(localStorage.getItem(checksKey()) || '{}');
          data[t.id] = cb.checked;
          localStorage.setItem(checksKey(), JSON.stringify(data));
        });
      });

      document.getElementById('resetToday').onclick = () => {
        localStorage.removeItem(checksKey());
        renderToday(dayIdx);
      };
    }

    // –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç–∞—Ä—Ç–æ–º
    const startInput = document.getElementById('startInput');
    const startIndexSelect = document.getElementById('startIndex');
    const startInfo = document.getElementById('startInfo');

    function loadStart() {
      const dateVal  = localStorage.getItem(KEY_START_DATE);
      const indexVal = localStorage.getItem(KEY_START_INDEX);
      if (dateVal && indexVal) {
        startInput.value = dateVal;
        startIndexSelect.value = indexVal;
        const dayIdx = getCycleDay(new Date(dateVal), Number(indexVal), new Date());
        startInfo.textContent = `–°—Ç–∞—Ä—Ç: ${dateVal}, –≤—ã–±—Ä–∞–Ω ¬´–î–µ–Ω—å ${indexVal}¬ª. –°–µ–≥–æ–¥–Ω—è ‚Äî –¥–µ–Ω—å ${dayIdx} –∏–∑ 8.`;
        document.getElementById('todayCard').hidden = false;
        renderToday(dayIdx);
      } else {
        startInfo.textContent = '–í—ã–±–µ—Ä–∏ –¥–∞—Ç—É –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å —Ü–∏–∫–ª–∞, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª.';
        document.getElementById('todayCard').hidden = true;
      }
    }

    document.getElementById('saveStartBtn').addEventListener('click', () => {
      if (!startInput.value) { alert('–í—ã–±–µ—Ä–∏ –¥–∞—Ç—É —Å—Ç–∞—Ä—Ç–∞'); return; }
      localStorage.setItem(KEY_START_DATE, startInput.value);
      localStorage.setItem(KEY_START_INDEX, startIndexSelect.value);
      loadStart();
    });

    document.getElementById('resetStartBtn').addEventListener('click', () => {
      localStorage.removeItem(KEY_START_DATE);
      localStorage.removeItem(KEY_START_INDEX);
      loadStart();
    });

    // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π
    document.getElementById('shareBtn').addEventListener('click', async () => {
      const url = location.href;
      if (navigator.share) {
        try { await navigator.share({ title:'–ú–æ–π 8-–¥–Ω–µ–≤–Ω—ã–π —Ü–∏–∫–ª', url }); } catch(e){}
      } else {
        await navigator.clipboard.writeText(url);
        alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
      }
    });

    // init
    renderGrid();
    loadStart();
  </script>
</body>
</html>
